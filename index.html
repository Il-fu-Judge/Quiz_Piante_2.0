<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botanica Quiz - Debug Mode</title>
    <style>
        :root { --green: #2d5a27; --orange: #f39c12; --blue: #3498db; --bg: #e8f0e8; }
        body { font-family: sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .box { background: white; padding: 20px; border-radius: 20px; text-align: center; width: 90%; max-width: 400px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .btn { padding: 15px; width: 100%; border-radius: 50px; border: none; color: white; font-weight: bold; cursor: pointer; margin: 10px 0; font-size: 1.1rem; }
        .btn-start { background: var(--green); }
        .btn-guess { background: var(--blue); }
        .btn-skip { background: var(--orange); }
        .mic-on { background: #e74c3c !important; animation: pulse 1s infinite; }
        .img-card { width: 100%; aspect-ratio: 3/4; background: #eee; border-radius: 15px; object-fit: cover; margin-bottom: 10px; }
        .hidden { display: none !important; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div id="start-screen" class="box">
    <h1 style="color: var(--green)">Botanica Voice</h1>
    <p>Riconosci le piante parlando.<br><b>5 salti disponibili.</b></p>
    <button class="btn btn-start" onclick="startGame()">INIZIA ORA</button>
</div>

<div id="game-area" class="box hidden">
    <div style="display: flex; justify-content: space-between; font-weight: bold; color: var(--green)">
        <span>Punti: <span id="score">0</span></span>
        <span>Salti: <span id="skips">5</span></span>
    </div>
    
    <img id="imageDisplay" class="img-card" src="" alt="Caricamento...">
    
    <button id="guessBtn" class="btn btn-guess" onclick="startListening()">ðŸŽ¤ INDOVINA</button>
    <button class="btn btn-skip" onclick="handleError('MANUAL_SKIP')">SALTA</button>
    
    <p id="transcript" style="font-style: italic; color: #666;">Pronto...</p>
</div>

<script>
// Elenco ridotto per test (tu puoi rimettere l'elenco completo qui)
const pianteOriginali = [
    { latino: "Abelia Grandiflora", img: "img/abelia_grandiflora.jpg" },
    { latino: "Agapanthus Umbrellatus", img: "img/agapanthus_umbrellatus.jpg" },
    { latino: "Aster", img: "img/aster.jpg" }
    // ... aggiungi le altre qui ...
];

let mazzo = [];
let currentPlant = null;
let score = 0;
let skipsLeft = 5;
let recognition = null;

// Prova a inizializzare subito per vedere se il browser supporta la funzione
try {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'it-IT';
        recognition.continuous = false;

        recognition.onresult = (event) => {
            const result = event.results[0][0].transcript.toLowerCase();
            document.getElementById('transcript').textContent = "Hai detto: " + result;
            checkAnswer(result);
        };

        recognition.onend = () => {
            const btn = document.getElementById('guessBtn');
            btn.classList.remove('mic-on');
            btn.textContent = "ðŸŽ¤ INDOVINA";
        };
    } else {
        alert("Errore: Il tuo browser non supporta il riconoscimento vocale. Usa Chrome.");
    }
} catch (e) {
    console.error("Errore inizializzazione vocale:", e);
}

function startGame() {
    console.log("Gioco avviato"); // Controlla la console del browser (F12)
    score = 0;
    skipsLeft = 5;
    mazzo = [...pianteOriginali].sort(() => Math.random() - 0.5);
    
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('game-area').classList.remove('hidden');
    
    nextQuestion();
}

function nextQuestion() {
    if (mazzo.length === 0) {
        alert("Complimenti! Mazzo finito.");
        location.reload();
        return;
    }
    currentPlant = mazzo.pop();
    const imgElement = document.getElementById('imageDisplay');
    
    // Fallback se l'immagine non esiste
    imgElement.onerror = () => { 
        console.error("Immagine non trovata:", currentPlant.img);
        document.getElementById('transcript').textContent = "Immagine mancante: " + currentPlant.img;
    };
    
    imgElement.src = currentPlant.img;
    document.getElementById('score').textContent = score;
    document.getElementById('skips').textContent = skipsLeft;
    document.getElementById('transcript').textContent = "In attesa...";
}

function startListening() {
    if (!recognition) return;
    try {
        recognition.start();
        const btn = document.getElementById('guessBtn');
        btn.classList.add('mic-on');
        btn.textContent = "ðŸ”´ TI ASCOLTO...";
    } catch (e) {
        console.warn("Riconoscimento giÃ  attivo o errore:", e);
    }
}

function checkAnswer(said) {
    const correct = currentPlant.latino.toLowerCase();
    // Logica di confronto
    if (said.includes(correct) || correct.includes(said)) {
        score++;
        document.body.style.backgroundColor = "#2ecc71";
        setTimeout(() => {
            document.body.style.backgroundColor = "#e8f0e8";
            nextQuestion();
        }, 800);
    } else {
        handleError();
    }
}

function handleError(type) {
    if (skipsLeft > 0) {
        skipsLeft--;
        alert("Sbagliato o Saltato!\nEra: " + currentPlant.latino);
        nextQuestion();
    } else {
        alert("PARTITA FINITA!\nLa pianta era: " + currentPlant.latino);
        location.reload();
    }
}
</script>
</body>
</html>
